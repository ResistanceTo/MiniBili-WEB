---
import AppHero from "@components/sections/AppHero";
import Changelog from "@components/sections/Changelog";
import Community from "@components/sections/Community";
import FAQ from "@components/sections/FAQ";
import Features from "@components/sections/Features";
import Screenshots from "@components/sections/Screenshots";
import AnnouncementBanner from "@components/ui/AnnouncementBanner";
import Lightbox from "@components/ui/Lightbox";
import ScrollNav from "@components/ui/ScrollNav";
import FAQSchema from "@components/seo/FAQSchema.astro";
import OrganizationSchema from "@components/seo/OrganizationSchema.astro";
import Layout from "@layouts/Layout.astro";
import { changelog } from "../config/changelog";
import { siteConfig } from "../config";

const { title, description, screenshots, features, faqs, storeLinks, logo, announcement } = siteConfig;
---

<Layout title={title} description={description} structuredDataType="mobileApplication">
  <!-- LCP -->
  <link rel="preload" as="image" href="/MiniBili.png" fetchpriority="high" slot="head" />

  <!-- 预加载视频以提升性能 -->
  {screenshots.iOS.map((item: any) => {
    if (typeof item === 'object' && item.type === 'video') {
      return (
        <>
          <link rel="preload" as="video" href={item.src} slot="head" />
          {item.poster && <link rel="preload" as="image" href={item.poster} slot="head" />}
        </>
      );
    }
  })}
  {screenshots.iPadOS.map((item: any) => {
    if (typeof item === 'object' && item.type === 'video') {
      return (
        <>
          <link rel="preload" as="video" href={item.src} slot="head" />
          {item.poster && <link rel="preload" as="image" href={item.poster} slot="head" />}
        </>
      );
    }
  })}

  <main class="min-h-screen max-w-5xl mx-auto px-4 py-8">
    {announcement && announcement.show && (
      <AnnouncementBanner
        message={announcement.message}
        type={announcement.type}
        dismissible={announcement.dismissible}
        show={announcement.show}
        client:load
      />
    )}
    <AppHero {title} {description} {storeLinks} {logo} client:load />
    <div class="mb-16"><Screenshots images={screenshots} client:load /></div>
    <Features items={features} />
    <Changelog items={changelog} client:visible />
    <FAQ items={faqs} client:visible />
    <Community client:visible />
  </main>
  <ScrollNav client:load />
</Layout>

<Lightbox images={screenshots} client:load />
<FAQSchema items={faqs} />
<OrganizationSchema />

<style is:global>
  .screenshots-scroll {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    &::-webkit-scrollbar { display: none; }
  }
</style>
